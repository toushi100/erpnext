!function(){"use strict";frappe.templates.item_dashboard='<div>  <div class="result">  </div>  <div class="more hidden" style="padding: 15px;">   <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div> ',frappe.templates.item_dashboard_list='{% for d in data %}  <div class="dashboard-list-item">   <div class="row">    <div class="col-sm-3" style="margin-top: 8px;">     <a data-type="warehouse" data-name="{{ d.warehouse }}">{{ d.warehouse }}</a>    </div>    <div class="col-sm-3" style="margin-top: 8px;">     {% if show_item %}      <a data-type="item"       data-name="{{ d.item_code }}">{{ d.item_code }}       {% if d.item_name != d.item_code %}({{ d.item_name }}){% endif %}      </a>     {% endif %}    </div>    <div class="col-sm-4">     <span class="inline-graph">      <span class="inline-graph-half" title="{{ __("Reserved Qty") }}">       <span class="inline-graph-count">{{ d.total_reserved }}</span>       <span class="inline-graph-bar">        <span class="inline-graph-bar-inner"         style="width: {{ cint(Math.abs(d.total_reserved)/max_count * 100) || 5 }}%">        </span>       </span>      </span>      <span class="inline-graph-half" title="{{ __("Actual Qty {0} / Waiting Qty {1}", [d.actual_qty, d.pending_qty]) }}">       <span class="inline-graph-count">        {{ d.actual_qty }} {{ (d.pending_qty > 0) ? ("(" + d.pending_qty+ ")") : "" }}       </span>       <span class="inline-graph-bar">        <span class="inline-graph-bar-inner dark"         style="width: {{ cint(d.actual_qty/max_count * 100) }}%">        </span>        {% if d.pending_qty > 0 %}        <span class="inline-graph-bar-inner" title="{{ __("Projected Qty") }}"         style="width: {{ cint(d.pending_qty/max_count * 100) }}%">        </span>        {% endif %}       </span>      </span>     </span>    </div>    {% if can_write %}    <div class="col-sm-2 text-right" style="margin: var(--margin-sm) 0;">     {% if d.actual_qty %}     <button class="btn btn-default btn-xs btn-move"      data-disable_quick_entry="{{ d.disable_quick_entry }}"      data-warehouse="{{ d.warehouse }}"      data-actual_qty="{{ d.actual_qty }}"      data-item="{{ escape(d.item_code) }}">{{ __("Move") }}</a>     {% endif %}     <button style="margin-left: 7px;" class="btn btn-default btn-xs btn-add"      data-disable_quick_entry="{{ d.disable_quick_entry }}"      data-warehouse="{{ d.warehouse }}"      data-actual_qty="{{ d.actual_qty }}"      data-item="{{ escape(d.item_code) }}"      data-rate="{{ d.valuation_rate }}">{{ __("Add") }}</a>    </div>    {% endif %}   </div>  </div> {% endfor %} ',frappe.provide("erpnext.stock"),erpnext.stock.ItemDashboard=Class.extend({init:function(e){$.extend(this,e),this.make()},make:function(){var e=this;function t(t,a){var s=unescape(t.attr("data-item")),i=unescape(t.attr("data-warehouse")),r=unescape(t.attr("data-actual_qty"));if(Number(unescape(t.attr("data-disable_quick_entry"))))!function(e,t,a){frappe.model.with_doctype("Stock Entry",function(){var s=frappe.model.get_new_doc("Stock Entry");a&&(s.stock_entry_type=a);var i=frappe.model.add_child(s,"items");i.item_code=e,i.s_warehouse=t,frappe.set_route("Form",s.doctype,s.name)})}(s,i,"Move"===a?"Material Transfer":null);else if("Add"===a){var n=unescape($(this).attr("data-rate"));erpnext.stock.move_item(s,null,i,r,n,function(){e.refresh()})}else erpnext.stock.move_item(s,i,null,r,null,function(){e.refresh()})}this.start=0,this.sort_by||(this.sort_by="projected_qty",this.sort_order="asc"),this.content=$(frappe.render_template("item_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),this.content.on("click",".btn-move",function(){t($(this),"Move")}),this.content.on("click",".btn-add",function(){t($(this),"Add")}),this.content.on("click",".btn-edit",function(){var e=unescape($(this).attr("data-item")),t=unescape($(this).attr("data-warehouse")),a=unescape($(this).attr("data-company"));frappe.db.get_value("Putaway Rule",{item_code:e,warehouse:t,company:a},"name",function(e){frappe.set_route("Form","Putaway Rule",e.name)})}),this.content.find(".btn-more").on("click",function(){e.start+=e.page_length,e.refresh()})},refresh:function(){this.before_refresh&&this.before_refresh();var e={item_code:this.item_code,warehouse:this.warehouse,parent_warehouse:this.parent_warehouse,item_group:this.item_group,company:this.company,start:this.start,sort_by:this.sort_by,sort_order:this.sort_order},t=this;frappe.call({method:this.method,args:e,callback:function(e){t.render(e.message)}})},render:function(e){0===this.start&&(this.max_count=0,this.result.empty());var t="";if(t="warehouse-capacity-summary"===this.page_name?this.get_capacity_dashboard_data(e):this.get_item_dashboard_data(e,this.max_count,!0),this.max_count=this.max_count,e&&e.length===this.page_length+1?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):this.content.find(".more").addClass("hidden"),t.data.length>0)this.content.find(".result").css("text-align","unset"),$(frappe.render_template(this.template,t)).appendTo(this.result);else{var a=__("No Stock Available Currently");this.content.find(".result").css("text-align","center"),$("<div class='text-muted' style='margin: 20px 5px;'>\n\t\t\t\t"+a+" </div>").appendTo(this.result)}},get_item_dashboard_data:function(e,t,a){t||(t=0),e||(e=[]),e.forEach(function(e){e.actual_or_pending=e.projected_qty+e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,e.pending_qty=0,e.total_reserved=e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,e.actual_or_pending>e.actual_qty&&(e.pending_qty=e.actual_or_pending-e.actual_qty),t=Math.max(e.actual_or_pending,e.actual_qty,e.total_reserved,t)});var s=0;return frappe.boot.user.can_write.indexOf("Stock Entry")>=0&&(s=1),{data:e,max_count:t,can_write:s,show_item:a||!1}},get_capacity_dashboard_data:function(e){e||(e=[]),e.forEach(function(e){e.color=e.percent_occupied>=80?"#f8814f":"#2490ef"});var t=0;return frappe.boot.user.can_write.indexOf("Putaway Rule")>=0&&(t=1),{data:e,can_write:t}}}),erpnext.stock.move_item=function(e,t,a,s,i,r){var n=new frappe.ui.Dialog({title:a?__("Add Item"):__("Move Item"),fields:[{fieldname:"item_code",label:__("Item"),fieldtype:"Link",options:"Item",read_only:1},{fieldname:"source",label:__("Source Warehouse"),fieldtype:"Link",options:"Warehouse",read_only:1},{fieldname:"target",label:__("Target Warehouse"),fieldtype:"Link",options:"Warehouse",reqd:1},{fieldname:"qty",label:__("Quantity"),reqd:1,fieldtype:"Float",description:__("Available {0}",[s])},{fieldname:"rate",label:__("Rate"),fieldtype:"Currency",hidden:1}]});n.show(),n.get_field("item_code").set_input(e),t?n.get_field("source").set_input(t):(n.get_field("source").df.hidden=1,n.get_field("source").refresh()),i&&(n.get_field("rate").set_value(i),n.get_field("rate").df.hidden=0,n.get_field("rate").refresh()),a&&(n.get_field("target").df.read_only=1,n.get_field("target").value=a,n.get_field("target").refresh()),n.set_primary_action(__("Submit"),function(){var e=n.get_values();e&&(t&&e.qty>s?frappe.msgprint(__("Quantity must be less than or equal to {0}",[s])):(e.source===e.target&&frappe.msgprint(__("Source and target warehouse must be different")),frappe.call({method:"erpnext.stock.doctype.stock_entry.stock_entry_utils.make_stock_entry",args:e,btn:n.get_primary_btn(),freeze:!0,freeze_message:__("Creating Stock Entry"),callback:function(e){frappe.show_alert(__("Stock Entry {0} created",['<a href="/app/stock-entry/'+e.message.name+'">'+e.message.name+"</a>"])),n.hide(),r(e)}})))}),$('<p style="margin-left: 10px;"><a class="link-open text-muted small">'+__("Add more items or open full form")+"</a></p>").appendTo(n.body).find(".link-open").on("click",function(){frappe.model.with_doctype("Stock Entry",function(){var e=frappe.model.get_new_doc("Stock Entry");e.from_warehouse=n.get_value("source"),e.to_warehouse=n.get_value("target");var t=frappe.model.add_child(e,"items");t.item_code=n.get_value("item_code"),t.f_warehouse=n.get_value("target"),t.t_warehouse=n.get_value("target"),t.qty=n.get_value("qty"),t.conversion_factor=1,t.transfer_qty=n.get_value("qty"),t.basic_rate=n.get_value("rate"),frappe.set_route("Form",e.doctype,e.name)})})},frappe.templates.warehouse_capacity_summary='{% for d in data %}  <div class="dashboard-list-item" style="padding: 7px 15px;">   <div class="row">    <div class="col-sm-2 small" style="margin-top: 8px;">     <a data-type="warehouse" data-name="{{ d.warehouse }}">{{ d.warehouse }}</a>    </div>    <div class="col-sm-2 small" style="margin-top: 8px; ">     <a data-type="item" data-name="{{ d.item_code }}">{{ d.item_code }}</a>    </div>    <div class="col-sm-1 small" style="margin-top: 8px; ">     {{ d.stock_capacity }}    </div>    <div class="col-sm-2 small" style="margin-top: 8px; ">     {{ d.actual_qty }}    </div>    <div class="col-sm-2 small">     <div class="progress" title="Occupied Qty: {{ d.actual_qty }}" style="margin-bottom: 4px; height: 7px; margin-top: 14px;">      <div class="progress-bar" role="progressbar"       aria-valuenow="{{ d.percent_occupied }}"       aria-valuemin="0" aria-valuemax="100"       style="width:{{ d.percent_occupied }}%;       background-color: {{ d.color }}">      </div>     </div>    </div>    <div class="col-sm-1 small" style="margin-top: 8px;">     {{ d.percent_occupied }}%    </div>    {% if can_write %}    <div class="col-sm-1 text-right" style="margin-top: 2px;">     <button class="btn btn-default btn-xs btn-edit"     style="margin-top: 4px;margin-bottom: 4px;"     data-warehouse="{{ d.warehouse }}"     data-item="{{ escape(d.item_code) }}"     data-company="{{ escape(d.company) }}">{{ __("Edit Capacity") }}</a>    </div>    {% endif %}   </div>  </div> {% endfor %} ',frappe.templates.warehouse_capacity_summary_header='<div class="dashboard-list-item" style="padding: 12px 15px;">  <div class="row">   <div class="col-sm-2 small text-muted" style="margin-top: 8px;">    Warehouse   </div>   <div class="col-sm-2 small text-muted" style="margin-top: 8px;">    Item   </div>   <div class="col-sm-1 small text-muted" style="margin-top: 8px;">    Stock Capacity   </div>   <div class="col-sm-2 small text-muted" style="margin-top: 8px;">    Balance Stock Qty   </div>   <div class="col-sm-2 small text-muted" style="margin-top: 8px;">    % Occupied   </div>  </div> </div> '}();
//# sourceMappingURL=item-dashboard.min.js.map
