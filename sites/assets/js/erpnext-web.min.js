!function(){"use strict";window.erpnext||(window.erpnext={}),frappe.send_message=function(e,t){return frappe.call({type:"POST",method:"erpnext.templates.utils.send_message",btn:t,args:e,callback:e.callback})},erpnext.subscribe_to_newsletter=function(e,t){return frappe.call({type:"POST",method:"frappe.email.doctype.newsletter.newsletter.subscribe",btn:t,args:{email:e.email},callback:e.callback})},erpnext.send_message=frappe.send_message,frappe.provide("erpnext.e_commerce.shopping_cart");var e=erpnext.e_commerce.shopping_cart;frappe.ready(function(){var t=frappe.session&&frappe.session.user_fullname;t&&$('.navbar li[data-label="User"] a').html('<i class="fa fa-fixed-width fa fa-user"></i> '+t);var a=function(e){var t=[],a=document.createElement("a");a.href=e;for(var i=a.search.substring(1).split("&"),n=0;n<i.length;n++){var s=i[n].split("=");t[s[0]]=decodeURIComponent(s[1])}return t}(window.location.href),i=a.cc,n=a.sp,s=new Date;s.setTime(s.getTime()+.48*60*60*1e3);var o="expires="+s.toUTCString();i&&(document.cookie="referral_coupon_code="+i+";"+o+";path=/"),n&&(document.cookie="referral_sales_partner="+n+";"+o+";path=/"),i=frappe.get_cookie("referral_coupon_code"),n=frappe.get_cookie("referral_sales_partner"),i&&null==$(".tot_quotation_discount").val()&&$(".txtcoupon").val(i),n&&$(".txtreferral_sales_partner").val(n),e.show_shoppingcart_dropdown(),e.set_cart_count(),e.show_cart_navbar()}),$.extend(e,{show_shoppingcart_dropdown:function(){$(".shopping-cart").on("shown.bs.dropdown",function(){if(!$(".shopping-cart-menu .cart-container").length)return frappe.call({method:"erpnext.e_commerce.shopping_cart.cart.get_shopping_cart_menu",callback:function(e){e.message&&$(".shopping-cart-menu").html(e.message)}})})},update_cart:function(t){if("Guest"!==frappe.session.user)return e.freeze(),frappe.call({type:"POST",method:"erpnext.e_commerce.shopping_cart.cart.update_cart",args:{item_code:t.item_code,qty:t.qty,additional_notes:void 0!==t.additional_notes?t.additional_notes:void 0,with_items:t.with_items||0},btn:t.btn,callback:function(a){e.unfreeze(),e.set_cart_count(!0),t.callback&&t.callback(a)}});localStorage&&localStorage.setItem("last_visited",window.location.pathname),frappe.call("erpnext.e_commerce.api.get_guest_redirect_on_action").then(function(e){window.location.href=e.message||"/login"})},set_cart_count:function(e){void 0===e&&(e=!1),$(".intermediate-empty-cart").remove();var t=frappe.get_cookie("cart_count");"Guest"===frappe.session.user&&(t=0),t&&$(".shopping-cart").toggleClass("hidden",!1);var a=$(".cart-icon"),i=a.find("#cart-count");if(0===parseInt(t)||void 0===t){a.css("display","none"),$(".cart-tax-items").hide(),$(".btn-place-order").hide(),$(".cart-payment-addresses").hide();var n='\n\t\t\t\t<div class="text-center w-100 intermediate-empty-cart mt-4 mb-4 text-muted">\n\t\t\t\t\t'+__("Cart is Empty")+"\n\t\t\t\t</div>\n\t\t\t";$(".cart-table").after(n)}else a.css("display","inline"),$("#cart-count").text(t);t?(i.html(t),e&&(a.addClass("cart-animate"),setTimeout(function(){a.removeClass("cart-animate")},500))):i.remove()},shopping_cart_update:function(t){var a=t.item_code,i=t.qty,n=t.cart_dropdown,s=t.additional_notes;e.update_cart({item_code:a,qty:i,additional_notes:s,with_items:1,btn:this,callback:function(t){t.exc||($(".cart-items").html(t.message.items),$(".cart-tax-items").html(t.message.total),$(".payment-summary").html(t.message.taxes_and_totals),e.set_cart_count(),1!=n&&$(".cart-icon").hide())}})},show_cart_navbar:function(){frappe.call({method:"erpnext.e_commerce.doctype.e_commerce_settings.e_commerce_settings.is_cart_enabled",callback:function(e){$(".shopping-cart").toggleClass("hidden",!e.message)}})},toggle_button_class:function(e,t,a){e.removeClass(t),e.addClass(a)},bind_add_to_cart_action:function(){$(".page_content").on("click",".btn-add-to-cart-list",function(e){var t=$(e.currentTarget);if(t.prop("disabled",!0),"Guest"===frappe.session.user)return localStorage&&localStorage.setItem("last_visited",window.location.pathname),void frappe.call("erpnext.e_commerce.api.get_guest_redirect_on_action").then(function(e){window.location.href=e.message||"/login"});t.addClass("hidden"),t.closest(".cart-action-container").addClass("d-flex"),t.parent().find(".go-to-cart").removeClass("hidden"),t.parent().find(".go-to-cart-grid").removeClass("hidden"),t.parent().find(".cart-indicator").removeClass("hidden");var a=t.data("item-code");erpnext.e_commerce.shopping_cart.update_cart({item_code:a,qty:1})})},freeze:function(){if("/cart"===window.location.pathname)if($("#freeze").length)$("#freeze").addClass("show");else{var e=$('<div id="freeze" class="modal-backdrop fade"></div>').appendTo("body");setTimeout(function(){e.addClass("show")},1)}},unfreeze:function(){if($("#freeze").length){var e=$("#freeze").removeClass("show");setTimeout(function(){e.remove()},1)}}}),frappe.provide("erpnext.e_commerce.wishlist");var t=erpnext.e_commerce.wishlist;frappe.provide("erpnext.e_commerce.shopping_cart");var a=erpnext.e_commerce.shopping_cart;$.extend(t,{set_wishlist_count:function(e){void 0===e&&(e=!1);var t=frappe.get_cookie("wish_count");"Guest"===frappe.session.user&&(t=0),t&&$(".wishlist").toggleClass("hidden",!1);var a=$(".wishlist-icon"),i=a.find("#wish-count");0===parseInt(t)||void 0===t?a.css("display","none"):a.css("display","inline"),t?(i.html(t),e&&(a.addClass("cart-animate"),setTimeout(function(){a.removeClass("cart-animate")},500))):i.remove()},bind_move_to_cart_action:function(){var e=this;$(".page_content").on("click",".btn-add-to-cart",function(t){var i=$(t.currentTarget),n=i.data("item-code");a.shopping_cart_update({item_code:n,qty:1,cart_dropdown:!0});var s={item_code:n};e.add_remove_from_wishlist("remove",s,function(){i.closest(".wishlist-card").addClass("wish-removed")},null,!0)})},bind_remove_action:function(){var e=this,t=this;$(".page_content").on("click",".remove-wish",function(a){var i=$(a.currentTarget),n={item_code:i.data("item-code")};e.add_remove_from_wishlist("remove",n,function(){i.closest(".wishlist-card").addClass("wish-removed"),0==frappe.get_cookie("wish_count")&&($(".page_content").empty(),t.render_empty_state())})})},bind_wishlist_action:function(){var e=this;$(".page_content").on("click",".like-action, .like-action-list",function(t){var a=$(t.currentTarget);e.wishlist_action(a)})},wishlist_action:function(e){var t=e.find(".wish-icon"),a=this;if("Guest"===frappe.session.user)return localStorage&&localStorage.setItem("last_visited",window.location.pathname),void this.redirect_guest();var i=function(){erpnext.e_commerce.wishlist.set_wishlist_count(!0)};if(t.hasClass("wished")){e.removeClass("like-animate"),e.addClass("like-action-wished"),this.toggle_button_class(t,"wished","not-wished");var n={item_code:e.data("item-code")};this.add_remove_from_wishlist("remove",n,i,function(){a.toggle_button_class(t,"not-wished","wished")})}else{e.addClass("like-animate"),e.addClass("like-action-wished"),this.toggle_button_class(t,"not-wished","wished");var s={item_code:e.data("item-code")};this.add_remove_from_wishlist("add",s,i,function(){a.toggle_button_class(t,"wished","not-wished")})}},toggle_button_class:function(e,t,a){e.removeClass(t),e.addClass(a)},add_remove_from_wishlist:function(e,t,a,i,n){if(void 0===n&&(n=!1),"Guest"===frappe.session.user)localStorage&&localStorage.setItem("last_visited",window.location.pathname),this.redirect_guest();else{var s="erpnext.e_commerce.doctype.wishlist.wishlist.add_to_wishlist";"remove"===e&&(s="erpnext.e_commerce.doctype.wishlist.wishlist.remove_from_wishlist"),frappe.call({async:n,type:"POST",method:s,args:t,callback:function(e){e.exc?(i&&"function"==typeof i&&i(),frappe.msgprint({message:__("Sorry, something went wrong. Please refresh."),indicator:"red",title:__("Note")})):a&&"function"==typeof a&&a()}})}},redirect_guest:function(){frappe.call("erpnext.e_commerce.api.get_guest_redirect_on_action").then(function(e){window.location.href=e.message||"/login"})},render_empty_state:function(){$(".page_content").append('\n\t\t\t<div class="cart-empty frappe-card">\n\t\t\t\t<div class="cart-empty-state">\n\t\t\t\t\t<img src="/assets/erpnext/images/ui-states/cart-empty-state.png" alt="Empty Cart">\n\t\t\t\t</div>\n\t\t\t\t<div class="cart-empty-message mt-4">'+__("Wishlist is empty !")+"</p>\n\t\t\t</div>\n\t\t")}}),frappe.ready(function(){"/wishlist"!==window.location.pathname?($(".wishlist").toggleClass("hidden",!0),t.set_wishlist_count()):(t.bind_move_to_cart_action(),t.bind_remove_action())})}();
//# sourceMappingURL=erpnext-web.min.js.map
