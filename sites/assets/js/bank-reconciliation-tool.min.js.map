{"version":3,"file":"bank-reconciliation-tool.min.js","sources":["../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/data_table_manager.js","../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/number_card.js","../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/dialog_manager.js"],"sourcesContent":["frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.DataTableManager = class DataTableManager {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.dialog_manager = new erpnext.accounts.bank_reconciliation.DialogManager(\n\t\t\tthis.company,\n\t\t\tthis.bank_account\n\t\t);\n\t\tthis.make_dt();\n\t}\n\n\tmake_dt() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_bank_transactions\",\n\t\t\targs: {\n\t\t\t\tbank_account: this.bank_account,\n\t\t\t},\n\t\t\tcallback: function (response) {\n\t\t\t\tme.format_data(response.message);\n\t\t\t\tme.get_dt_columns();\n\t\t\t\tme.get_datatable();\n\t\t\t\tme.set_listeners();\n\t\t\t},\n\t\t});\n\t}\n\n\tget_dt_columns() {\n\t\tthis.columns = [\n\t\t\t{\n\t\t\t\tname: \"Date\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tname: \"Party Type\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 95,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Party\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Description\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 350,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Deposit\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:green;'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Withdrawal\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:red;'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Unallocated Amount\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:blue;'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Reference Number\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 140,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Actions\",\n\t\t\t\teditable: false,\n\t\t\t\tsortable: false,\n\t\t\t\tfocusable: false,\n\t\t\t\tdropdown: false,\n\t\t\t\twidth: 80,\n\t\t\t},\n\t\t];\n\t}\n\n\tformat_data(transactions) {\n\t\tthis.transactions = [];\n\t\tif (transactions[0]) {\n\t\t\tthis.currency = transactions[0][\"currency\"];\n\t\t}\n\t\tthis.transaction_dt_map = {};\n\t\tlet length;\n\t\ttransactions.forEach((row) => {\n\t\t\tlength = this.transactions.push(this.format_row(row));\n\t\t\tthis.transaction_dt_map[row[\"name\"]] = length - 1;\n\t\t});\n\t}\n\n\tformat_row(row) {\n\t\treturn [\n\t\t\trow[\"date\"],\n\t\t\trow[\"party_type\"],\n\t\t\trow[\"party\"],\n\t\t\trow[\"description\"],\n\t\t\trow[\"deposit\"],\n\t\t\trow[\"withdrawal\"],\n\t\t\trow[\"unallocated_amount\"],\n\t\t\trow[\"reference_number\"],\n\t\t\t`\n\t\t\t<Button class=\"btn btn-primary btn-xs center\"  data-name = ${row[\"name\"]} >\n\t\t\t\tActions\n\t\t\t</a>\n\t\t\t`,\n\t\t];\n\t}\n\n\tget_datatable() {\n\t\tconst datatable_options = {\n\t\t\tcolumns: this.columns,\n\t\t\tdata: this.transactions,\n\t\t\tdynamicRowHeight: true,\n\t\t\tcheckboxColumn: false,\n\t\t\tinlineFilters: true,\n\t\t};\n\t\tthis.datatable = new frappe.DataTable(\n\t\t\tthis.$reconciliation_tool_dt.get(0),\n\t\t\tdatatable_options\n\t\t);\n\t\t$(`.${this.datatable.style.scopeClass} .dt-scrollable`).css(\n\t\t\t\"max-height\",\n\t\t\t\"calc(100vh - 400px)\"\n\t\t);\n\n\t\tif (this.transactions.length > 0) {\n\t\t\tthis.$reconciliation_tool_dt.show();\n\t\t\tthis.$no_bank_transactions.hide();\n\t\t} else {\n\t\t\tthis.$reconciliation_tool_dt.hide();\n\t\t\tthis.$no_bank_transactions.show();\n\t\t}\n\t}\n\n\tset_listeners() {\n\t\tvar me = this;\n\t\t$(`.${this.datatable.style.scopeClass} .dt-scrollable`).on(\n\t\t\t\"click\",\n\t\t\t`.btn`,\n\t\t\tfunction () {\n\t\t\t\tme.dialog_manager.show_dialog(\n\t\t\t\t\t$(this).attr(\"data-name\"),\n\t\t\t\t\t(bank_transaction) => me.update_dt_cards(bank_transaction)\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t);\n\t}\n\n\tupdate_dt_cards(bank_transaction) {\n\t\tconst transaction_index = this.transaction_dt_map[\n\t\t\tbank_transaction.name\n\t\t];\n\t\tif (bank_transaction.unallocated_amount > 0) {\n\t\t\tthis.transactions[transaction_index] = this.format_row(\n\t\t\t\tbank_transaction\n\t\t\t);\n\t\t} else {\n\t\t\tthis.transactions.splice(transaction_index, 1);\n\t\t}\n\t\tthis.datatable.refresh(this.transactions, this.columns);\n\n\t\tif (this.transactions.length == 0) {\n\t\t\tthis.$reconciliation_tool_dt.hide();\n\t\t\tthis.$no_bank_transactions.show();\n\t\t}\n\n\t\t// this.make_dt();\n\t\tthis.get_cleared_balance().then(() => {\n\t\t\tthis.cards_manager.$cards[1].set_value(\n\t\t\t\tformat_currency(this.cleared_balance),\n\t\t\t\tthis.currency\n\t\t\t);\n\t\t\tthis.cards_manager.$cards[2].set_value(\n\t\t\t\tformat_currency(\n\t\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance\n\t\t\t\t),\n\t\t\t\tthis.currency\n\t\t\t);\n\t\t\tthis.cards_manager.$cards[2].set_value_color(\n\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance == 0\n\t\t\t\t\t? \"text-success\"\n\t\t\t\t\t: \"text-danger\"\n\t\t\t);\n\t\t});\n\t}\n\n\tget_cleared_balance() {\n\t\tif (this.bank_account && this.bank_statement_to_date) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_account_balance\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_account: this.bank_account,\n\t\t\t\t\ttill_date: this.bank_statement_to_date,\n\t\t\t\t},\n\t\t\t\tcallback: (response) =>\n\t\t\t\t\t(this.cleared_balance = response.message),\n\t\t\t});\n\t\t}\n\t}\n};\n","frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.NumberCardManager = class NumberCardManager {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make_cards();\n\t}\n\n\tmake_cards() {\n\t\tthis.$reconciliation_tool_cards.empty();\n\t\tthis.$cards = [];\n\t\tthis.$summary = $(`<div class=\"report-summary\"></div>`)\n\t\t\t.hide()\n\t\t\t.appendTo(this.$reconciliation_tool_cards);\n\t\tvar chart_data = [\n\t\t\t{\n\t\t\t\tvalue: this.bank_statement_closing_balance,\n\t\t\t\tlabel: \"Closing Balance as per Bank Statement\",\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t\t{\n\t\t\t\tvalue: this.cleared_balance,\n\t\t\t\tlabel: \"Closing Balance as per ERP\",\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t\t{\n\t\t\t\tvalue:\n\t\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance,\n\t\t\t\tlabel: \"Difference\",\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t];\n\n\t\tchart_data.forEach((summary) => {\n\t\t\tlet number_card = new erpnext.accounts.NumberCard(summary);\n\t\t\tthis.$cards.push(number_card);\n\n\t\t\tnumber_card.$card.appendTo(this.$summary);\n\t\t});\n\t\tthis.$cards[2].set_value_color(\n\t\t\tthis.bank_statement_closing_balance - this.cleared_balance == 0\n\t\t\t\t? \"text-success\"\n\t\t\t\t: \"text-danger\"\n\t\t);\n\t\tthis.$summary.css({\"border-bottom\": \"0px\", \"margin-left\": \"0px\", \"margin-right\": \"0px\"});\n\t\tthis.$summary.show();\n\t}\n};\n\nerpnext.accounts.NumberCard = class NumberCard {\n\tconstructor(options) {\n\t\tthis.$card = frappe.utils.build_summary_item(options);\n\t}\n\n\tset_value(value) {\n\t\tthis.$card.find(\"div\").text(value);\n\t}\n\n\tset_value_color(color) {\n\t\tthis.$card\n\t\t\t.find(\"div\")\n\t\t\t.removeClass(\"text-danger text-success\")\n\t\t\t.addClass(`${color}`);\n\t}\n\n\tset_indicator(color) {\n\t\tthis.$card\n\t\t\t.find(\"span\")\n\t\t\t.removeClass(\"indicator red green\")\n\t\t\t.addClass(`indicator ${color}`);\n\t}\n};\n","frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.DialogManager = class DialogManager {\n\tconstructor(company, bank_account) {\n\t\tthis.bank_account = bank_account;\n\t\tthis.company = company;\n\t\tthis.make_dialog();\n\t}\n\n\tshow_dialog(bank_transaction_name, update_dt_cards) {\n\t\tthis.bank_transaction_name = bank_transaction_name;\n\t\tthis.update_dt_cards = update_dt_cards;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Bank Transaction\",\n\t\t\t\tfilters: { name: this.bank_transaction_name },\n\t\t\t\tfieldname: [\n\t\t\t\t\t\"date\",\n\t\t\t\t\t\"deposit\",\n\t\t\t\t\t\"withdrawal\",\n\t\t\t\t\t\"currency\",\n\t\t\t\t\t\"description\",\n\t\t\t\t\t\"name\",\n\t\t\t\t\t\"bank_account\",\n\t\t\t\t\t\"company\",\n\t\t\t\t\t\"reference_number\",\n\t\t\t\t\t\"party_type\",\n\t\t\t\t\t\"party\",\n\t\t\t\t\t\"unallocated_amount\",\n\t\t\t\t\t\"allocated_amount\",\n\t\t\t\t],\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tthis.bank_transaction = r.message;\n\t\t\t\t\tr.message.payment_entry = 1;\n\t\t\t\t\tthis.dialog.set_values(r.message);\n\t\t\t\t\tthis.dialog.show();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tget_linked_vouchers(document_types) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_linked_payments\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction_name,\n\t\t\t\tdocument_types: document_types,\n\t\t\t},\n\n\t\t\tcallback: (result) => {\n\t\t\t\tconst data = result.message;\n\n\n\t\t\t\tif (data && data.length > 0) {\n\t\t\t\t\tconst proposals_wrapper = this.dialog.fields_dict.payment_proposals.$wrapper;\n\t\t\t\t\tproposals_wrapper.show();\n\t\t\t\t\tthis.dialog.fields_dict.no_matching_vouchers.$wrapper.hide();\n\t\t\t\t\tthis.data = [];\n\t\t\t\t\tdata.forEach((row) => {\n\t\t\t\t\t\tconst reference_date = row[5] ? row[5] : row[8];\n\t\t\t\t\t\tthis.data.push([\n\t\t\t\t\t\t\trow[1],\n\t\t\t\t\t\t\trow[2],\n\t\t\t\t\t\t\treference_date,\n\t\t\t\t\t\t\tformat_currency(row[3], row[9]),\n\t\t\t\t\t\t\trow[6],\n\t\t\t\t\t\t\trow[4],\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t\tthis.get_dt_columns();\n\t\t\t\t\tthis.get_datatable(proposals_wrapper);\n\t\t\t\t} else {\n\t\t\t\t\tconst proposals_wrapper = this.dialog.fields_dict.payment_proposals.$wrapper;\n\t\t\t\t\tproposals_wrapper.hide();\n\t\t\t\t\tthis.dialog.fields_dict.no_matching_vouchers.$wrapper.show();\n\n\t\t\t\t}\n\t\t\t\tthis.dialog.show();\n\t\t\t},\n\t\t});\n\t}\n\n\tget_dt_columns() {\n\t\tthis.columns = [\n\t\t\t{\n\t\t\t\tname: \"Document Type\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 125,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Document Name\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 150,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Reference Date\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 120,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Amount\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Party\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 120,\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tname: \"Reference Number\",\n\t\t\t\teditable: false,\n\t\t\t\twidth: 140,\n\t\t\t},\n\t\t];\n\t}\n\n\tget_datatable(proposals_wrapper) {\n\t\tif (!this.datatable) {\n\t\t\tconst datatable_options = {\n\t\t\t\tcolumns: this.columns,\n\t\t\t\tdata: this.data,\n\t\t\t\tdynamicRowHeight: true,\n\t\t\t\tcheckboxColumn: true,\n\t\t\t\tinlineFilters: true,\n\t\t\t};\n\t\t\tthis.datatable = new frappe.DataTable(\n\t\t\t\tproposals_wrapper.get(0),\n\t\t\t\tdatatable_options\n\t\t\t);\n\t\t} else {\n\t\t\tthis.datatable.refresh(this.data, this.columns);\n\t\t\tthis.datatable.rowmanager.checkMap = [];\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tconst me = this;\n\t\tme.selected_payment = null;\n\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: __(\"Action\"),\n\t\t\t\tfieldname: \"action\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Match Against Voucher\\nCreate Voucher\\nUpdate Bank Transaction`,\n\t\t\t\tdefault: \"Match Against Voucher\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_4\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Document Type\"),\n\t\t\t\tfieldname: \"document_type\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Payment Entry\\nJournal Entry`,\n\t\t\t\tdefault: \"Payment Entry\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"section_break_1\",\n\t\t\t\tlabel: __(\"Filters\"),\n\t\t\t\tdepends_on: \"eval:doc.action=='Match Against Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Payment Entry\",\n\t\t\t\tfieldname: \"payment_entry\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Journal Entry\",\n\t\t\t\tfieldname: \"journal_entry\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_5\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Sales Invoice\",\n\t\t\t\tfieldname: \"sales_invoice\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Purchase Invoice\",\n\t\t\t\tfieldname: \"purchase_invoice\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_5\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Expense Claim\",\n\t\t\t\tfieldname: \"expense_claim\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Show Only Exact Amount\",\n\t\t\t\tfieldname: \"exact_match\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"section_break_1\",\n\t\t\t\tlabel: __(\"Select Vouchers to Match\"),\n\t\t\t\tdepends_on: \"eval:doc.action=='Match Against Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"payment_proposals\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"no_matching_vouchers\",\n\t\t\t\toptions: \"<div class=\\\"text-muted text-center\\\">No Matching Vouchers Found</div>\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"details\",\n\t\t\t\tlabel: \"Details\",\n\t\t\t\tdepends_on: \"eval:doc.action!='Match Against Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"reference_number\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: \"Reference Number\",\n\t\t\t\tmandatory_depends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tdefault: \"Today\",\n\t\t\t\tfieldname: \"posting_date\",\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tlabel: \"Posting Date\",\n\t\t\t\treqd: 1,\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"reference_date\",\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tlabel: \"Cheque/Reference Date\",\n\t\t\t\tmandatory_depends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t\treqd: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"edit_in_full_page\",\n\t\t\t\tfieldtype: \"Button\",\n\t\t\t\tlabel: \"Edit in Full Page\",\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.edit_in_full_page();\n\t\t\t\t},\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_7\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tdefault: \"Journal Entry Type\",\n\t\t\t\tfieldname: \"journal_entry_type\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\tlabel: \"Journal Entry Type\",\n\t\t\t\toptions:\n\t\t\t\t\t\"Journal Entry\\nInter Company Journal Entry\\nBank Entry\\nCash Entry\\nCredit Card Entry\\nDebit Note\\nCredit Note\\nContra Entry\\nExcise Entry\\nWrite Off Entry\\nOpening Entry\\nDepreciation Entry\\nExchange Rate Revaluation\\nDeferred Revenue\\nDeferred Expense\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"second_account\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Account\",\n\t\t\t\toptions: \"Account\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tget_query: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tis_group: 0,\n\t\t\t\t\t\t\tcompany: this.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"party_type\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Party Type\",\n\t\t\t\toptions: \"DocType\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Payment Entry'\",\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tname: [\n\t\t\t\t\t\t\t\t\"in\",\n\t\t\t\t\t\t\t\tObject.keys(frappe.boot.party_account_types),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"party\",\n\t\t\t\tfieldtype: \"Dynamic Link\",\n\t\t\t\tlabel: \"Party\",\n\t\t\t\toptions: \"party_type\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"project\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Project\",\n\t\t\t\toptions: \"Project\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"cost_center\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Cost Center\",\n\t\t\t\toptions: \"Cost Center\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"details_section\",\n\t\t\t\tlabel: \"Transaction Details\",\n\t\t\t\tcollapsible: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"deposit\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Deposit\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"withdrawal\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Withdrawal\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"description\",\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tlabel: \"Description\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_17\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"allocated_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Allocated Amount\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tfieldname: \"unallocated_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Unallocated Amount\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t];\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Reconcile the Bank Transaction\"),\n\t\t\tfields: fields,\n\t\t\tsize: \"large\",\n\t\t\tprimary_action: (values) =>\n\t\t\t\tthis.reconciliation_dialog_primary_action(values),\n\t\t});\n\t}\n\n\tget_selected_attributes() {\n\t\tlet selected_attributes = [];\n\t\tthis.dialog.$wrapper.find(\".checkbox input\").each((i, col) => {\n\t\t\tif ($(col).is(\":checked\")) {\n\t\t\t\tselected_attributes.push($(col).attr(\"data-fieldname\"));\n\t\t\t}\n\t\t});\n\n\t\treturn selected_attributes;\n\t}\n\n\tupdate_options() {\n\t\tlet selected_attributes = this.get_selected_attributes();\n\t\tthis.get_linked_vouchers(selected_attributes);\n\t}\n\n\treconciliation_dialog_primary_action(values) {\n\t\tif (values.action == \"Match Against Voucher\") this.match(values);\n\t\tif (\n\t\t\tvalues.action == \"Create Voucher\" &&\n\t\t\tvalues.document_type == \"Payment Entry\"\n\t\t)\n\t\t\tthis.add_payment_entry(values);\n\t\tif (\n\t\t\tvalues.action == \"Create Voucher\" &&\n\t\t\tvalues.document_type == \"Journal Entry\"\n\t\t)\n\t\t\tthis.add_journal_entry(values);\n\t\telse if (values.action == \"Update Bank Transaction\")\n\t\t\tthis.update_transaction(values);\n\t}\n\n\tmatch() {\n\t\tvar selected_map = this.datatable.rowmanager.checkMap;\n\t\tlet rows = [];\n\t\tselected_map.forEach((val, index) => {\n\t\t\tif (val == 1) rows.push(this.datatable.datamanager.rows[index]);\n\t\t});\n\t\tlet vouchers = [];\n\t\trows.forEach((x) => {\n\t\t\tvouchers.push({\n\t\t\t\tpayment_doctype: x[2].content,\n\t\t\t\tpayment_name: x[3].content,\n\t\t\t\tamount: x[5].content,\n\t\t\t});\n\t\t});\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.reconcile_vouchers\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\tvouchers: vouchers,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string =\n\t\t\t\t\t\"Bank Transaction \" +\n\t\t\t\t\tthis.bank_transaction.name +\n\t\t\t\t\t\" Matched\";\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_payment_entry(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_payment_entry_bts\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\treference_date: values.reference_date,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t\tposting_date: values.posting_date,\n\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\tproject: values.project,\n\t\t\t\tcost_center: values.cost_center,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string =\n\t\t\t\t\t\"Bank Transaction \" +\n\t\t\t\t\tthis.bank_transaction.name +\n\t\t\t\t\t\" added as Payment Entry\";\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_journal_entry(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_journal_entry_bts\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\treference_date: values.reference_date,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t\tposting_date: values.posting_date,\n\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\tentry_type: values.journal_entry_type,\n\t\t\t\tsecond_account: values.second_account,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string =\n\t\t\t\t\t\"Bank Transaction \" +\n\t\t\t\t\tthis.bank_transaction.name +\n\t\t\t\t\t\" added as Journal Entry\";\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tupdate_transaction(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.update_bank_transaction\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string =\n\t\t\t\t\t\"Bank Transaction \" +\n\t\t\t\t\tthis.bank_transaction.name +\n\t\t\t\t\t\" updated\";\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tedit_in_full_page() {\n\t\tconst values = this.dialog.get_values(true);\n\t\tif (values.document_type == \"Payment Entry\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_payment_entry_bts\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\t\treference_number: values.reference_number,\n\t\t\t\t\treference_date: values.reference_date,\n\t\t\t\t\tparty_type: values.party_type,\n\t\t\t\t\tparty: values.party,\n\t\t\t\t\tposting_date: values.posting_date,\n\t\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\t\tproject: values.project,\n\t\t\t\t\tcost_center: values.cost_center,\n\t\t\t\t\tallow_edit: true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tconst doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", doc[0].doctype, doc[0].name);\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_journal_entry_bts\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\t\treference_number: values.reference_number,\n\t\t\t\t\treference_date: values.reference_date,\n\t\t\t\t\tparty_type: values.party_type,\n\t\t\t\t\tparty: values.party,\n\t\t\t\t\tposting_date: values.posting_date,\n\t\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\t\tentry_type: values.journal_entry_type,\n\t\t\t\t\tsecond_account: values.second_account,\n\t\t\t\t\tallow_edit: true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", doc[0].doctype, doc[0].name);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n};\n"],"names":["frappe","provide","erpnext","accounts","bank_reconciliation","DataTableManager","[object Object]","opts","Object","assign","this","dialog_manager","DialogManager","company","bank_account","make_dt","me","call","method","args","callback","response","format_data","message","get_dt_columns","get_datatable","set_listeners","columns","name","editable","width","format","value","format_currency","currency","sortable","focusable","dropdown","transactions","length","transaction_dt_map","forEach","row","push","format_row","const","datatable_options","data","dynamicRowHeight","checkboxColumn","inlineFilters","datatable","DataTable","$reconciliation_tool_dt","get","$","style","css","show","$no_bank_transactions","hide","on","show_dialog","attr","bank_transaction","update_dt_cards","transaction_index","unallocated_amount","splice","refresh","get_cleared_balance","then","cards_manager","$cards","set_value","cleared_balance","bank_statement_closing_balance","set_value_color","bank_statement_to_date","till_date","NumberCardManager","make_cards","$reconciliation_tool_cards","empty","$summary","appendTo","label","datatype","summary","let","number_card","NumberCard","$card","border-bottom","margin-left","margin-right","options","utils","build_summary_item","find","text","color","removeClass","addClass","make_dialog","bank_transaction_name","doctype","filters","fieldname","r","payment_entry","dialog","set_values","document_types","result","proposals_wrapper","fields_dict","payment_proposals","$wrapper","no_matching_vouchers","reference_date","rowmanager","checkMap","selected_payment","fields","__","fieldtype","default","depends_on","onchange","update_options","mandatory_depends_on","reqd","click","edit_in_full_page","get_query","is_group","keys","boot","party_account_types","collapsible","read_only","ui","Dialog","title","size","primary_action","values","reconciliation_dialog_primary_action","selected_attributes","each","i","col","is","get_selected_attributes","get_linked_vouchers","action","match","document_type","add_payment_entry","add_journal_entry","update_transaction","selected_map","rows","val","index","datamanager","vouchers","x","payment_doctype","content","payment_name","amount","alert_string","show_alert","reference_number","party_type","party","posting_date","mode_of_payment","project","cost_center","entry_type","journal_entry_type","second_account","get_values","allow_edit","doc","model","sync","set_route"],"mappings":"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"}